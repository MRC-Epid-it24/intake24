(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{387:function(t,e,s){t.exports=s.p+"assets/img/meal-list.7c9a60c6.png"},388:function(t,e,s){t.exports=s.p+"assets/img/prompt-example.eb0595d8.png"},454:function(t,e,s){"use strict";s.r(e);var a=s(28),o=Object(a.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"version-3-recall-model"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#version-3-recall-model"}},[t._v("#")]),t._v(" Version 3 recall model")]),t._v(" "),a("p",[t._v("This page describes the data and user interaction models used for Intake24 version 3.")]),t._v(" "),a("h2",{attrs:{id:"data-structure-summary"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#data-structure-summary"}},[t._v("#")]),t._v(" Data structure summary")]),t._v(" "),a("p",[t._v("A dietary recall object in Intake24 consists simply of a list of meals, each in turn consisting of a list of foods.")]),t._v(" "),a("p",[t._v("Every object (i.e. recall, meals, foods) has a "),a("code",[t._v("flags")]),t._v(" field and a "),a("code",[t._v("customFields")]),t._v(" field that can be used by custom\nstudy schemes to attach additional study-specific data to objects, for instance for meals this could be data like\nwhere the food was consumed (at school, at home etc.) and for foods this could where this specific item was bought.")]),t._v(" "),a("p",[t._v("The recall object has additional standard fields like the recall start time and the submission time, meals have\ndescriptions and meal times, etc.")]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[t._v("This section is not intended to provide a detailed description of the version 3 data structures\nbut to serve as a reference for version 4 developers.")])]),t._v(" "),a("p",[t._v("The data structure looks approximately like this:")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"startTime"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"..."')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"endTime"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"..."')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"flags"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("..."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"customData"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("..."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"meals"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Breakfast"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"time"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"18:00"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"flags"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("..."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"customData"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("..."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"foods"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n           code"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ABCD123"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n           searchTerm"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"..."')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n           "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"flags"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("..."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n           "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"customData"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("..."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n           portionSize"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ..."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n           ...       \n         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n         ... "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// other foods in breakfast")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n     ... "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// other meals")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"meal-food-list"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#meal-food-list"}},[t._v("#")]),t._v(" Meal/food list")]),t._v(" "),a("img",{staticStyle:{float:"right","margin-left":"15px","margin-top":"15px",border:"2px solid lightgrey"},attrs:{src:s(387)}}),t._v(" "),a("p",[t._v("In version 3 the meal list panel can be found on the left side of the screen. Initially it shows the\nstandard list of meals suggested by the system (breakfast, lunch etc.) and the meals are empty. Respondents\nare free to delete or add more meals as required.")]),t._v(" "),a("p",[t._v("Every meal consists of a list of foods. The green tick marks (see screenshot on the right) represent the completion\nstate of the food item. First pass (no ticks) is the free text entry which means that the description of the food\nitem has been entered as an arbitrary text by the responent. Second pass (one tick) means that the free text description\nhas been matched with a food from the database and the respondent has selected the food that they think best\nmatches their description.")]),t._v(" "),a("div",{staticStyle:{clear:"both"}}),t._v(" "),a("h3",{attrs:{id:"linked-foods"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#linked-foods"}},[t._v("#")]),t._v(" Linked foods")]),t._v(" "),a("p",[t._v("Some foods in a meal can be marked as linked to some other food, which is called the "),a("em",[t._v("main food")]),t._v(". This is mostly\na visual change (linked foods are always grouped under the main food) and does not affect the underlying data structure,\nin the sense that the final result is still a flat list of foods.")]),t._v(" "),a("p",[t._v("The linking information is also used by the associated foods system in order to determine what associated foods\nhave already been entered and don't need to be suggested. For instance, if there is a spread is linked to a toast,\nthe associated foods system will not suggest any other spreads.")]),t._v(" "),a("h2",{attrs:{id:"selection"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#selection"}},[t._v("#")]),t._v(" Selection")]),t._v(" "),a("p",[t._v("The central concept of the recall flow logic is the "),a("em",[t._v("current selection")]),t._v(".")]),t._v(" "),a("p",[t._v("The current selection can be one of the following:")]),t._v(" "),a("ul",[a("li",[t._v("Nothing")]),t._v(" "),a("li",[t._v("Meal")]),t._v(" "),a("li",[t._v("Food")])]),t._v(" "),a("p",[t._v("Additionally, the system differentiates between "),a("em",[t._v("manual selection")]),t._v(" and "),a("em",[t._v("automatic selection")]),t._v(".")]),t._v(" "),a("p",[t._v("The current selection type is set to manual when the respondent clicks on a food or a meal. The selection type is\nset to automatic when the system has exhausted prompts for the current selection and automatically moves on to the\nnext item.")]),t._v(" "),a("p",[t._v("Prompt rules (see below) can look at the selection type to determine what prompts are applicable to the current\nselection, for instance some prompts will only trigger on manual selection.")]),t._v(" "),a("h3",{attrs:{id:"automatic-selection-algorithm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#automatic-selection-algorithm"}},[t._v("#")]),t._v(" Automatic selection algorithm")]),t._v(" "),a("p",[t._v("The current automatic selection algorithm works as follows:")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("In the below pseudocode "),a("strong",[t._v("try")]),t._v(" means to check whether the food or meal has any active prompts by evaluating\nthe relevant prompt rules.")]),t._v(" "),a("p",[t._v("If the candidate food or meal has one or more enabled prompts, it becomes the new selection and the\nselection is marked as automatic.")]),t._v(" "),a("p",[t._v("Unless stated otherwise the foods are always tried in the order they had been entered, and the meals\nare tried in the chronological order.")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("  if current selection is nothing {\n\n    try all foods in all meals starting with the chronologically first meal;\n\n    if none of the foods have prompts available try all meals\n  }\n\n  if (current selection is a meal) {\n\n    try foods in the selected meal;\n\n    try foods in the next meal;\n\n    try foods in all other meals, starting from the first;\n\n    if none of the foods have enabled prompts try all meals\n  }\n\n  if (current selection is a food) {\n\n    try next food in the same meal;\n\n    if the food is linked to some other food, try that food;\n\n    try all other foods in the same meal starting from the first;\n\n    try the current meal;\n\n    try the meal that follows the current meal;\n\n    try all foods in all meals;\n\n    try all meals;     \n  }\n")])])]),a("p",[t._v('If no further item can be selected, i.e. there are no enabled prompts left for any meal or food, the recall is\nmarked as complete and the system proceeds to the final questions about the whole recall ("survey prompts").')]),t._v(" "),a("p",[t._v('At this point the respondent can still add meals by clicking on the "Add meal" button or foods by clicking on a\nmeal in the list.')]),t._v(" "),a("h2",{attrs:{id:"prompts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prompts"}},[t._v("#")]),t._v(" Prompts")]),t._v(" "),a("img",{staticStyle:{float:"right","margin-left":"15px","margin-top":"15px",border:"2px solid lightgrey"},attrs:{src:s(388)}}),t._v(" "),a("p",[t._v("The main building block of the dietary recall is called a "),a("em",[t._v("prompt")]),t._v(". A prompt is usually a simple question about\nthe currently selected item.")]),t._v(" "),a("p",[t._v("For example, a meal confirmation prompt asks to confirm the time when the respondent had the meal, a ready meal\nprompt asks which foods from a meal were ready made etc.")]),t._v(" "),a("p",[t._v("Some prompts are more sophisticated (e.g, portion size estimation prompts) and could consist of several stages,\nhowever in any case the purpose of a prompt is to present a UI to ask a question and add one specific block of\ndata to the currently selected item (or to the recall as a whole) based on the respondent's answer.")]),t._v(" "),a("h3",{attrs:{id:"prompt-types"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prompt-types"}},[t._v("#")]),t._v(" Prompt types")]),t._v(" "),a("p",[t._v("There are currently four prompt types in the system. The type of a prompt determines what selection type it is\napplicable to.")]),t._v(" "),a("p",[t._v("The prompt types are:")]),t._v(" "),a("h4",{attrs:{id:"_1-food-prompts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-food-prompts"}},[t._v("#")]),t._v(" 1. Food prompts")]),t._v(" "),a("p",[t._v("Applicable to foods regardless of context (i.e. ignoring other foods in the meal). Food prompt UI only has access\nto data pertaining to the selected food and can only modify this food. An example of a food prompt is the\nportion size estimation.")]),t._v(" "),a("h4",{attrs:{id:"_2-extended-food-prompts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-extended-food-prompts"}},[t._v("#")]),t._v(" 2. Extended food prompts")]),t._v(" "),a("p",[t._v("Extended food prompts also apply to foods, however they also have access to other foods in the same meal. This\ntype of prompt is used when the food context matters, such as the associated food prompts. Extended food prompts can\nmodify the selected food or add or modify foods in the same meal.")]),t._v(" "),a("h4",{attrs:{id:"_3-meal-prompts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-meal-prompts"}},[t._v("#")]),t._v(" 3. Meal prompts")]),t._v(" "),a("p",[t._v("Meal prompts apply to meals. They can modify both the data about the meal itself, change the list of foods,\nand any data about the foods in the meal.")]),t._v(" "),a("p",[t._v("Examples of meal prompts are the meal confirmation prompt that asks for the time of the meal, the free text food\nentry prompt, or the drinks reminder prompt.")]),t._v(" "),a("h4",{attrs:{id:"_4-survey-prompts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-survey-prompts"}},[t._v("#")]),t._v(" 4. Survey prompts")]),t._v(" "),a("p",[t._v('Finally, survey prompts are prompts that collect information about the whole recall. This is typically additional\nquestions such as the context of the submission ("was it a usual day?", "are you following a diet?") or questions\nthat relate to the whole day ("did you take any dietary supplements?").')]),t._v(" "),a("div",{staticStyle:{clear:"both"}}),t._v(" "),a("h3",{attrs:{id:"prompt-rules"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prompt-rules"}},[t._v("#")]),t._v(" Prompt rules")]),t._v(" "),a("p",[t._v("Prompt rules are special functions that are used to determine if a prompt can be shown for the given food or meal.\nTypically they inspect the current state of the meal or food, however some rules can also take the overall state\nof the recall into consideration. For instance, some prompts are only applicable during the second pass of the\nmulti-pass model and the current pass is determined by a global survey flag.")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("Prompt rules are associated with the corresponding prompt type UI, which means that a collection of prompt\nrules is all that is needed to define and customise the recall flow.")])]),t._v(" "),a("h2",{attrs:{id:"main-recall-loop"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#main-recall-loop"}},[t._v("#")]),t._v(" Main recall loop")]),t._v(" "),a("p",[t._v("When selecting the next prompt from a set of enabled prompts (i.e. the current selection has more than one\nenabled prompt) Intake24 v3 uses a prompt priority score, however these priorities are currently equivalent\nto the order in which the prompt rules are listed in the code and should be removed.")]),t._v(" "),a("p",[t._v("In version 3 the main recall loop is implemented with a recursive function "),a("strong",[t._v("showNextPrompt()")]),t._v(":")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("function showNextPrompt() {\n\n  get next prompt for current selection;\n\n  if (next prompt available) {\n     show prompt UI;\n     when prompt completes, show next prompt;\n  } else {\n     select next item that has an enabled prompt; // see selection algorithm above\n     \n     if (selection available) {\n       show next prompt;\n     } else {\n\n        get next prompt for survey; // prompts related to the whole recall and not individual\n                                       items\n\n        if (next prompt available) {\n           show prompt UI;\n           when prompt completes, show next prompt;\n        } else {\n           show submission page;\n        }\n     }\n  }\n}\n\n")])])]),a("h2",{attrs:{id:"multiple-pass-recall-model"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#multiple-pass-recall-model"}},[t._v("#")]),t._v(" Multiple-pass recall model")]),t._v(" "),a("p",[t._v('Intake24 uses the so-called multiple-pass recall model. The multiple-pass approach simply means that the questions\nare grouped into "passes" and the system will not ask any questions associated with subsequent passes until all of\nthe questions in the previous passes are exhausted.')]),t._v(" "),a("p",[t._v("In other words the system will initially go over all of the meals and foods and ask questions from the first pass only,\nand when no more questions remain it will go back to the first meal and start asking question from the second pass.")]),t._v(" "),a("p",[t._v("This model is somewhat complicated by the ability of the respondent to freely add or delete meals and foods at any point\nduring the recall. Although the first pass could have been finished prompts from this pass still have to be shown\nfor the new entries.")]),t._v(" "),a("p",[t._v("In Intake24 v3 this logic is implemented using global recall flags in combination with prompt rule logic. For instance,\nwhen the first pass prompts have been exhausted the system will mark the recall with a special flag that will unlock\nthe second pass prompts, however if a new food is added the first pass prompts will still be shown for that food.")]),t._v(" "),a("p",[t._v("This interaction can sometimes lead to complicated interaction between prompts and the selection order.")])])}),[],!1,null,null,null);e.default=o.exports}}]);