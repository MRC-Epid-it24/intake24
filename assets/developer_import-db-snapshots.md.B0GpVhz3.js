import{_ as e,c as a,o as t,ag as o}from"./chunks/framework.CDhRSyRB.js";const u=JSON.parse('{"title":"Import database snapshots","description":"","frontmatter":{},"headers":[],"relativePath":"developer/import-db-snapshots.md","filePath":"developer/import-db-snapshots.md"}'),n={name:"developer/import-db-snapshots.md"};function i(p,s,d,l,c,r){return t(),a("div",null,s[0]||(s[0]=[o(`<h1 id="import-database-snapshots" tabindex="-1">Import database snapshots <a class="header-anchor" href="#import-database-snapshots" aria-label="Permalink to &quot;Import database snapshots&quot;">​</a></h1><p>If you have a DB snapshots of Intake24, you can use CLI to import to the database server.</p><h2 id="postgresql" tabindex="-1">PostgreSQL <a class="header-anchor" href="#postgresql" aria-label="Permalink to &quot;PostgreSQL&quot;">​</a></h2><p>PostgreSQL is running on the standard port <code>5432</code>.</p><p>The Intake24 databases are:</p><ul><li>System database: <code>intake24_system</code>, user <code>intake24</code>, no password.</li><li>Foods database: <code>intake24_foods</code>, user <code>intake24</code>, no password.</li></ul><h2 id="importing-foods-and-system-databases" tabindex="-1">Importing foods and system databases <a class="header-anchor" href="#importing-foods-and-system-databases" aria-label="Permalink to &quot;Importing foods and system databases&quot;">​</a></h2><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Note: The scripts in this sessions aimed for setup PostgreSQL for Intake24 local development purpose only.</p></div><ol><li>Export PostgresQL username password and host name to local development environment.</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>export PGUSER=&#39;postgres&#39;</span></span>
<span class="line"><span>export PGPASSWORD=&#39;postgres&#39;</span></span>
<span class="line"><span>export PGHOST=&quot;localhost&quot;</span></span></code></pre></div><ol start="2"><li>Create a user in Postgres called <code>intake24</code> with password <code>intake24</code></li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>psql -d postgres -c &quot;CREATE ROLE intake24 WITH PASSWORD &#39;intake24&#39; LOGIN;&quot;</span></span></code></pre></div><ol start="3"><li>Create DB <code>intake24_foods</code> and add extensions</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>createdb --owner=intake24 intake24_foods</span></span>
<span class="line"><span>psql -d intake24_foods -c &quot;create extension btree_gist&quot;</span></span>
<span class="line"><span>psql -d intake24_foods -c &quot;create extension \\&quot;uuid-ossp\\&quot;&quot;</span></span></code></pre></div><ol start="4"><li>Import snapshot file to DB <code>intake24_foods</code></li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pg_restore -n public --no-owner --no-acl --role=intake24 --dbname intake24_foods ./intake24-foods-snapshot.pgcustom</span></span></code></pre></div><p>Change the path of the snapshot file as needed, e.g. <code>intake24-foods-snapshot.pgcustom</code></p><ol start="5"><li>Create DB <code>intake24_system</code></li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>createdb --owner=intake24 intake24_system</span></span></code></pre></div><ol start="6"><li>Import snapshot file to DB <code>intake24_system</code>.</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pg_restore -n public --no-owner --no-acl --role=intake24 --dbname intake24_system ./intake24-system-snapshot.pgcustom</span></span></code></pre></div><p>Change the path of the snapshot file as needed, e.g. <code>intake24-system-snapshot.pgcustom</code></p><ol start="7"><li>Login to <code>intake24_system</code> using PSQL, and insert admin user (e.g. <code>admin@example.com</code>, or any email you prefer) to <code>users</code> table.</li></ol><p>Write down return user id. It will be useful in the next step.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>psql -d intake24_system</span></span>
<span class="line"><span></span></span>
<span class="line"><span>insert into users (id, &quot;name&quot;, email, phone, simple_name, email_notifications, sms_notifications, multi_factor_authentication, created_at, updated_at, verified_at, disabled_at) values (default, &#39;Admin&#39;, &#39;admin@example.com&#39;, &#39;&#39;, &#39;Admin&#39;, true, true, false, now(), now(), now(), null) returning id;</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>id</span></span>
<span class="line"><span>-------</span></span>
<span class="line"><span>11969</span></span>
<span class="line"><span>(1 row)</span></span></code></pre></div><ol start="8"><li>Go to the <code>apps/cli</code> directory in the source tree and run</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pnpm run cli hash-password [your password]</span></span></code></pre></div><p>Replace <code>[your password]</code> to the password you want.</p><ol start="9"><li>Replace <code>[hash]</code> and <code>[salt]</code> with the password hash and salt generated, and insert to user by id.</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>insert into user_passwords (user_id, password_hash, password_salt, password_hasher) values (11969, &#39;[hash]&#39;, &#39;[salt]&#39;, &#39;bcrypt&#39;);</span></span></code></pre></div><ol start="10"><li>Give this user id superuser permissions:</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>insert into role_user (role_id, user_id, created_at, updated_at) values (1, 11969, now(), now());</span></span></code></pre></div><p>By that you created admin test account <code>admin@example.com</code> in development database.</p>`,34)]))}const m=e(n,[["render",i]]);export{u as __pageData,m as default};
