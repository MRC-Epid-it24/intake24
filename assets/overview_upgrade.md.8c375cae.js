import{_ as a,c as e,o as s,a as t}from"./app.27199562.js";const b=JSON.parse('{"title":"Upgrade guide","description":"","frontmatter":{},"headers":[{"level":2,"title":"Database migrations","slug":"database-migrations","link":"#database-migrations","children":[{"level":3,"title":"Migrate system database","slug":"migrate-system-database","link":"#migrate-system-database","children":[]},{"level":3,"title":"Migrate foods database","slug":"migrate-foods-database","link":"#migrate-foods-database","children":[]},{"level":3,"title":"Seed databases with relevant data","slug":"seed-databases-with-relevant-data","link":"#seed-databases-with-relevant-data","children":[]}]}],"relativePath":"overview/upgrade.md"}'),d={name:"overview/upgrade.md"},n=t(`<h1 id="upgrade-guide" tabindex="-1">Upgrade guide <a class="header-anchor" href="#upgrade-guide" aria-hidden="true">#</a></h1><p>Intake24 V3 to V4 upgrade guide (WIP)</p><h2 id="database-migrations" tabindex="-1">Database migrations <a class="header-anchor" href="#database-migrations" aria-hidden="true">#</a></h2><p>Use most up-to-date V3 <code>foods</code> and <code>system</code> databases to run the migrations.</p><h3 id="migrate-system-database" tabindex="-1">Migrate system database <a class="header-anchor" href="#migrate-system-database" aria-hidden="true">#</a></h3><div class="language-sh"><button class="copy"></button><span class="lang">sh</span><pre><code><span class="line"><span style="color:#A6ACCD;">pnpm db:system:migrate</span></span>
<span class="line"></span></code></pre></div><h3 id="migrate-foods-database" tabindex="-1">Migrate foods database <a class="header-anchor" href="#migrate-foods-database" aria-hidden="true">#</a></h3><div class="language-sh"><button class="copy"></button><span class="lang">sh</span><pre><code><span class="line"><span style="color:#A6ACCD;">pnpm db:foods:migrate</span></span>
<span class="line"></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Depending on size of the databases, migration process can take from seconds to minutes. Both databases are being upgraded to use int8 instead of int4, which takes most of the time.</p><p>If you run into query timeout issues, you will have to increase the limits in sequelize config file (<code>packages/db/sequelize/{foods|system}/config.js</code>).</p></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Run the migration in specified order:</p><ol><li>System database</li><li>Foods database</li></ol><p>Some of the system database migrations are using foods database data (e.g. feedback data conversion into feedback-schemes) and eventually V3 old tables are dropped. Running the migrations in wrong order will fail.</p></div><h3 id="seed-databases-with-relevant-data" tabindex="-1">Seed databases with relevant data <a class="header-anchor" href="#seed-databases-with-relevant-data" aria-hidden="true">#</a></h3><p>Some of V3 data are being moved to database. To get this data into the database, run relevant seeders.</p><h4 id="standard-units" tabindex="-1">Standard units <a class="header-anchor" href="#standard-units" aria-hidden="true">#</a></h4><p>Standard units are being moved from V3 translation files to database. To seed the database with V3 source code standard units, run the following command:</p><div class="language-sh"><button class="copy"></button><span class="lang">sh</span><pre><code><span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> packages/db</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">pnpm sequelize db:seed --seed 20220926160654-v3-standard-portions.js --options-path sequelize/foods/options.js</span></span>
<span class="line"></span></code></pre></div>`,15),i=[n];function o(r,l,c,p,h,g){return s(),e("div",null,i)}const m=a(d,[["render",o]]);export{b as __pageData,m as default};
