<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Testing | Intake24 Documentation</title>
    <meta name="generator" content="VuePress 1.9.5">
    
    <meta name="description" content="Intake24 dietary recall system">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.c03b297c.css" as="style"><link rel="preload" href="/assets/js/app.466ea358.js" as="script"><link rel="preload" href="/assets/js/2.9512e104.js" as="script"><link rel="preload" href="/assets/js/71.29ae03f9.js" as="script"><link rel="prefetch" href="/assets/js/10.db2359ed.js"><link rel="prefetch" href="/assets/js/11.57c46580.js"><link rel="prefetch" href="/assets/js/12.bf8cc62c.js"><link rel="prefetch" href="/assets/js/13.09b5002d.js"><link rel="prefetch" href="/assets/js/14.386639bf.js"><link rel="prefetch" href="/assets/js/15.80cae80e.js"><link rel="prefetch" href="/assets/js/16.49e58106.js"><link rel="prefetch" href="/assets/js/17.d42804c6.js"><link rel="prefetch" href="/assets/js/18.7d8209af.js"><link rel="prefetch" href="/assets/js/19.5784478c.js"><link rel="prefetch" href="/assets/js/20.c28b671f.js"><link rel="prefetch" href="/assets/js/21.f89c53f1.js"><link rel="prefetch" href="/assets/js/22.a36cd06a.js"><link rel="prefetch" href="/assets/js/23.6c4ad652.js"><link rel="prefetch" href="/assets/js/24.3423fdab.js"><link rel="prefetch" href="/assets/js/25.eda09205.js"><link rel="prefetch" href="/assets/js/26.2814af68.js"><link rel="prefetch" href="/assets/js/27.abb5b5e6.js"><link rel="prefetch" href="/assets/js/28.13ba3558.js"><link rel="prefetch" href="/assets/js/29.cd0bedbb.js"><link rel="prefetch" href="/assets/js/3.f481dcd6.js"><link rel="prefetch" href="/assets/js/30.259a2389.js"><link rel="prefetch" href="/assets/js/31.b2cfeaf0.js"><link rel="prefetch" href="/assets/js/32.f13e3f66.js"><link rel="prefetch" href="/assets/js/33.c448d58a.js"><link rel="prefetch" href="/assets/js/34.a103d5da.js"><link rel="prefetch" href="/assets/js/35.e645c46f.js"><link rel="prefetch" href="/assets/js/36.741f0a6a.js"><link rel="prefetch" href="/assets/js/37.9838f603.js"><link rel="prefetch" href="/assets/js/38.a08fc328.js"><link rel="prefetch" href="/assets/js/39.b3d53d91.js"><link rel="prefetch" href="/assets/js/4.66c08c38.js"><link rel="prefetch" href="/assets/js/40.dd0b75c0.js"><link rel="prefetch" href="/assets/js/41.15fdf1d4.js"><link rel="prefetch" href="/assets/js/42.2252502a.js"><link rel="prefetch" href="/assets/js/43.4a428f35.js"><link rel="prefetch" href="/assets/js/44.d5b1e43b.js"><link rel="prefetch" href="/assets/js/45.3929c273.js"><link rel="prefetch" href="/assets/js/46.33dc0779.js"><link rel="prefetch" href="/assets/js/47.ec903af0.js"><link rel="prefetch" href="/assets/js/48.2aaca418.js"><link rel="prefetch" href="/assets/js/49.7d616cfb.js"><link rel="prefetch" href="/assets/js/5.c6b01817.js"><link rel="prefetch" href="/assets/js/50.74c45de3.js"><link rel="prefetch" href="/assets/js/51.d07f0875.js"><link rel="prefetch" href="/assets/js/52.fe03cd9c.js"><link rel="prefetch" href="/assets/js/53.730f11b9.js"><link rel="prefetch" href="/assets/js/54.30bfc7ed.js"><link rel="prefetch" href="/assets/js/55.2198dbf7.js"><link rel="prefetch" href="/assets/js/56.6d920731.js"><link rel="prefetch" href="/assets/js/57.2393f355.js"><link rel="prefetch" href="/assets/js/58.362089bc.js"><link rel="prefetch" href="/assets/js/59.e42ccc99.js"><link rel="prefetch" href="/assets/js/6.02caeaf8.js"><link rel="prefetch" href="/assets/js/60.d167cbf4.js"><link rel="prefetch" href="/assets/js/61.afe0362c.js"><link rel="prefetch" href="/assets/js/62.9433fbab.js"><link rel="prefetch" href="/assets/js/63.2a580256.js"><link rel="prefetch" href="/assets/js/64.6a1e8039.js"><link rel="prefetch" href="/assets/js/65.42b0fa69.js"><link rel="prefetch" href="/assets/js/66.4d364c3f.js"><link rel="prefetch" href="/assets/js/67.e4ca515d.js"><link rel="prefetch" href="/assets/js/68.e9b27956.js"><link rel="prefetch" href="/assets/js/69.1fb19fbe.js"><link rel="prefetch" href="/assets/js/7.d157f265.js"><link rel="prefetch" href="/assets/js/70.6507e206.js"><link rel="prefetch" href="/assets/js/72.ba202ffa.js"><link rel="prefetch" href="/assets/js/73.a1fadd61.js"><link rel="prefetch" href="/assets/js/74.630d694f.js"><link rel="prefetch" href="/assets/js/75.b1854b5f.js"><link rel="prefetch" href="/assets/js/76.a87cb086.js"><link rel="prefetch" href="/assets/js/8.4f56d265.js"><link rel="prefetch" href="/assets/js/9.366f5d92.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c03b297c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Intake24 Documentation</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/config/" class="nav-link">
  Configuration
</a></div><div class="nav-item"><a href="/api/" class="nav-link">
  API
</a></div><div class="nav-item"><a href="/survey/" class="nav-link">
  Survey
</a></div><div class="nav-item"><a href="/admin/" class="nav-link">
  Admin
</a></div><div class="nav-item"><a href="/data-dictionary/" class="nav-link">
  Data Dictionary
</a></div><div class="nav-item"><a href="/developer/" class="nav-link router-link-active">
  Developer resources
</a></div> <a href="https://github.com/MRC-Epid-it24/intake24" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/config/" class="nav-link">
  Configuration
</a></div><div class="nav-item"><a href="/api/" class="nav-link">
  API
</a></div><div class="nav-item"><a href="/survey/" class="nav-link">
  Survey
</a></div><div class="nav-item"><a href="/admin/" class="nav-link">
  Admin
</a></div><div class="nav-item"><a href="/data-dictionary/" class="nav-link">
  Data Dictionary
</a></div><div class="nav-item"><a href="/developer/" class="nav-link router-link-active">
  Developer resources
</a></div> <a href="https://github.com/MRC-Epid-it24/intake24" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Developer resources</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/developer/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/developer/source-code.html" class="sidebar-link">Source code</a></li><li><a href="/developer/getting-started.html" class="sidebar-link">Getting started</a></li><li><a href="/developer/technology-stack.html" class="sidebar-link">Technology Stack</a></li><li><a href="/developer/testing.html" aria-current="page" class="active sidebar-link">Testing</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/developer/testing.html#api-server" class="sidebar-link">API Server</a></li><li class="sidebar-sub-header"><a href="/developer/testing.html#admin-survey-apps" class="sidebar-link">Admin &amp; Survey apps</a></li></ul></li><li><a href="/developer/vm.html" class="sidebar-link">Development virtual machine</a></li><li><a href="/developer/v3-survey.html" class="sidebar-link">Version 3 recall model</a></li><li><a href="/developer/portion-size.html" class="sidebar-link">Portion size methods</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="testing"><a href="#testing" class="header-anchor">#</a> Testing</h1> <p>Tests are set up with <a href="https://jestjs.io" target="_blank" rel="noopener noreferrer">Jest<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> framework.</p> <p>All tests can be triggered from top-level repository structure.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>API Server integration test and some unit tests interacts with database, so be sure to set up empty testing databases and <code>__tests__/.env-test</code> file correctly. See below for more details.</p></div> <p>Tests are always located in <code>__tests__</code> folder in each <code>app</code> or <code>package</code> and use following directory structure convention. <code>__tests__</code> folder for <code>apps</code> has <code>unit</code> and <code>integration</code> subfolders as it will most likely have more then unit tests. While unit tests for <code>packages</code> are located directly in <code>__tests__</code>.</p> <div class="language- extra-class"><pre class="language-text"><code>├─ apps
│  └─ {application}
│     └─ __tests__
│        ├─ unit
│           └─ my-function1.spec.ts
│        └─ integration
│           └─ my-function2.spec.ts
├─ packages
   └─ {package}
      └─ __tests__
        └─ my-function3.spec.ts
</code></pre></div><p>Unit tests in <code>apps</code> folders</p> <p>Use following commands to run unit tests across repository and trigger tests in <code>__tests__</code> folders and <code>__tests__/unit</code> folders for package and apps, respectively. <code>Jest</code> will search for all files with <code>.spec.ts</code> extension.</p> <div class="language- extra-class"><pre class="language-text"><code>pnpm run test:unit

pnpm run test:unit:watch
</code></pre></div><p>Integration tests can be run with following commands. At the moment, there are only API Server integration tests, so it re-triggers the api internal npm command.</p> <div class="language- extra-class"><pre class="language-text"><code>pnpm run test:integration

pnpm run test:integration:watch
</code></pre></div><h2 id="api-server"><a href="#api-server" class="header-anchor">#</a> API Server</h2> <p>To run unit and integration tests on your local machine, start by copying your <code>.env</code> file to <code>__tests__/.env-test</code>.</p> <p>Make sure to edit the <code>.env-test</code> file and change the database settings to point to test databases instead of your
normal development ones. The foods and system test databases should be empty databases with the necessary
extensions (e.g., <code>uuid-ossp</code>) installed.</p> <div class="custom-block danger"><p class="custom-block-title">DANGER</p> <p><strong>Do not run any tests</strong> unless you're sure that the database configuration settings in the <code>.env-test</code> file are
correct because the test framework setup code will <strong>destroy all data</strong> in those databases!</p></div> <p>If using the development VM, simply copy <code>__tests__/.env-test-dev-vm</code> to <code>__tests__/.env-test</code> and you're good to go.</p> <p>Backend testing is set up for <code>unit</code> and <code>integration</code> tests. You can run tests with following commands.</p> <p>Unit tests</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">pnpm</span> run test:unit
</code></pre></div><p>Unit tests watch for development</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">pnpm</span> run test:unit:watch
</code></pre></div><p>Integration tests</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">pnpm</span> run test:integration
</code></pre></div><p>Integration tests watch for development</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">pnpm</span> run test:integration:watch
</code></pre></div><h2 id="admin-survey-apps"><a href="#admin-survey-apps" class="header-anchor">#</a> Admin &amp; Survey apps</h2> <p>Frontends use Vue.js Jest implementation, so you can run tests with:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">pnpm</span> run <span class="token builtin class-name">test</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/developer/technology-stack.html" class="prev">
        Technology Stack
      </a></span> <span class="next"><a href="/developer/vm.html">
        Development virtual machine
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.466ea358.js" defer></script><script src="/assets/js/2.9512e104.js" defer></script><script src="/assets/js/71.29ae03f9.js" defer></script>
  </body>
</html>
